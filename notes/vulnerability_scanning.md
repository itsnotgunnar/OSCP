## Vulnerability Scanning

The process of identifying the attack surface of a piece of software, system, or network.

1. Host discovery
2. Port scanning
3. Operating system, service, and version detection
4. Matching the results to a vulnerability database

False positives occur when there is a wrong service or version detected, the existance of a configuration that makes the target unexploitable, or when backporting is present.

Understand the inner workings of your vulnerability scanning tool, so that you better understand its blindspots.

### Nessus

- The minimum hardware requirements Tenable recommends are 4 CPU cores and 8GB of RAM. 

- Nessus does not scan UDP ports by default, as it significantly increases the scan duration.

- If you know which hosts are available, disable *Host Discovery* to save time and scan the targets more quietly. (*Discovery* > *Host Discovery* > toggle *Ping the remote host* to Off)

- If you do not configure any credentials, the scan will run unauthenticated.

- Change the default settings in *ASSESSMENT* if you would like to brute force user credentials.

- To reduce false negatives, you can configure an *Audit Trail*, which allows you to analyze why a specific plugin behaved in a certain way

- For Linux and macOS targets, SSH is used. While we can also use SSH on Windows, in most cases, we will use Server Message Block (SMB) and Windows Management Instrumentation (WMI)to perform authenticated vulnerability scans against Windows targets. Both methods allow us to use local or domain accounts and different authentication options.

- You can add exceptions to handle terminations by firewalls or IPS

### Nmap

How to leverage nmap as a lightweight vulnerability scanner.

Scripts categorized as "safe" have no potential impact to stability, and those categorized as "intrusive" may crash the target system or service.

The /usr/share/nmap/scripts/script.db file serves as an index to all currently available NSE scripts.
```bash
kali@kali:/usr/share/nmap/scripts$ cat script.db  | grep "\"vuln\""
Entry { filename = "afp-path-vuln.nse", categories = { "exploit", "intrusive", "vuln", } }
Entry { filename = "broadcast-avahi-dos.nse", categories = { "broadcast", "dos", "intrusive", "vuln", } }
Entry { filename = "clamav-exec.nse", categories = { "exploit", "vuln", } }
Entry { filename = "distcc-cve2004-2687.nse", categories = { "exploit", "intrusive", "vuln", } }
Entry { filename = "dns-update.nse", categories = { "intrusive", "vuln", } }
...
```

```bash
nmap -sV --script vulners [--script-args mincvss=<arg_val>] <target>
```

The arguments for --script can be a category, a Boolean  expression, a comma-separated list of categories, the full or wildcard-specified name of a NSE script in script.db, or an absolute path to a specific script.

How to download and setup a new script with nmap:
```bash
kali@kali:~$ sudo cp /home/kali/Downloads/http-vuln-cve-2021-41773.nse /usr/share/nmap/scripts/http-vuln-cve2021-41773.nse

kali@kali:~$ sudo nmap --script-updatedb
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org )
NSE: Updating rule database.
NSE: Script Database updated successfully.
Nmap done: 0 IP addresses (0 hosts up) scanned in 0.54 seconds
```

Custom scripts are a great way to mass scan for recently discovered, in order to grab low-hanging fruit. Scanners can only discover vulnerabilities that they are configured for.

Nmap is great to use when you don't have a full-fledged vulnerability scanner available.

**An NSE script may contain malicious code that gives an attacker full access to our system**